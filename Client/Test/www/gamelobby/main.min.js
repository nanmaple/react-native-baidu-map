var GameConfig;!function(e){function t(e){return"http://"+this.Domain+"/"+e+"/"}e.IsDebug=!1,e.Domain="www.zyyft.cn",e.CacheType=0,e.WebApiBaseUrl="http://192.168.0.2:9113",e.DesignWidth=1334,e.DesignHeight=750,e.GetRedirectUrl=t}(GameConfig||(GameConfig={}));var Utils;!function(e){var t=function(){function e(){}return e.GetQuery=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=Laya.Browser.window.location.search.substr(1).match(t);return null!=o?Laya.Browser.window.unescape(o[2]):null},e}();e.Url=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){this.headers=["Accept","application/json","Content-Type","application/x-www-form-urlencoded","Access-Control-Allow-Origin","*"]}return e.prototype.Request=function(e,t,o,n,i,r,a){void 0===n&&(n=this.headers);var s=new Laya.HttpRequest;s.http.timeout=1e4,s.once(Laya.Event.COMPLETE,this,i),s.once(Laya.Event.ERROR,this,r),s.on(Laya.Event.PROGRESS,this,a),s.send(t,o,e,"json",n)},e.prototype.Post=function(e,t,o,n,i,r){void 0===t&&(t={}),void 0===o&&(o=null),o=this.ObjectToArray(o,this.headers);var a="",s=new Array;if(t){for(var c in t)s.push(c+"="+t[c]);a=s.join("&")}this.Request("post",e,a,o,function(e){n&&n(e)},function(e){i&&i(e)},function(e){r&&r(e)})},e.prototype.Get=function(e,t,o,n,i,r){void 0===t&&(t={}),void 0===o&&(o=null),o=this.ObjectToArray(o,this.headers);var a,s=new Array;if(t){for(var c in t)s.push(c+"="+t[c]);a=s.join("&"),e=e+"?"+a,t=""}this.Request("get",e,t,o,function(e){n&&n(e)},function(e){i&&i(e)},function(e){r&&r(e)})},e.prototype.SetAuthorization=function(e){void 0===e&&(e=""),this.SetKeyValue("Authorization",e,this.headers)},e.prototype.SetHeader=function(e){this.headers=this.ObjectToArray(e,this.headers)},e.prototype.ObjectToArray=function(e,t){if(!e)return t;for(var o in e)e.hasOwnProperty(o)&&(t=this.SetKeyValue(o,e[o],t));return t},e.prototype.SetKeyValue=function(e,t,o){var n=o.indexOf(e);return-1==n?t&&o.push(e,t):null!==t?o.splice(n+1,1,t):o.splice(n,2),o},e}();e.Http=t}(Utils||(Utils={}));var Utils;!function(e){var t;!function(e){e[e.LOCALSTORAGE=0]="LOCALSTORAGE",e[e.COOKIE=1]="COOKIE",e[e.SESSION=2]="SESSION"}(t=e.StorageType||(e.StorageType={}));var o=function(){function e(){}return e.prototype.Set=function(e,o,n,i){switch(void 0===n&&(n=t.LOCALSTORAGE),void 0===i&&(i=7),n){case t.LOCALSTORAGE:this.SetLocalStorage(e,o,i);break;case t.COOKIE:Laya.Browser.window.navigator.cookieEnabled?this.SetCookie(e,o,i):this.SetLocalStorage(e,o,i);break;case t.SESSION:this.SetSessionStorage(e,o,i)}},e.prototype.Get=function(e,o){switch(void 0===o&&(o=t.LOCALSTORAGE),o){case t.LOCALSTORAGE:return this.GetLocalStorage(e);case t.COOKIE:return Laya.Browser.window.navigator.cookieEnabled?this.GetCookie(e):this.GetLocalStorage(e);case t.SESSION:return this.GetSessionStorage(e)}},e.prototype.Del=function(e,o){switch(void 0===o&&(o=t.LOCALSTORAGE),o){case t.LOCALSTORAGE:return this.RemoveLocalStorage(e);case t.COOKIE:return this.DelCookie(e);case t.SESSION:return this.RemoveSessionStorage(e)}},e.prototype.Clear=function(e){switch(void 0===e&&(e=t.LOCALSTORAGE),e){case t.LOCALSTORAGE:return this.ClearLocalStorage();case t.SESSION:return this.ClearSessionStorage()}},e.prototype.SetCookie=function(e,t,o){void 0===o&&(o=7);var n=Laya.Browser.window.document.cookie,i=new Date;i.setTime(i.getTime()+24*o*3600*1e3),n=e+"="+Laya.Browser.window.escape(t)+";expires="+i.toUTCString()+";path=/"},e.prototype.GetCookie=function(e){var t,o=Laya.Browser.window.document.cookie,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=o.match(n))?Laya.Browser.window.unescape(t[2]):null},e.prototype.DelCookie=function(e){var t=this.GetCookie(e);null!=t&&this.SetCookie(e,"",-1)},e.prototype.ClearCookie=function(){},e.prototype.SetLocalStorage=function(e,t,o){void 0===o&&(o=null);var n=new Date,i={expires:n.getTime()+24*o*3600*1e3,value:t};Laya.LocalStorage.setItem(e,JSON.stringify(i))},e.prototype.GetLocalStorage=function(e){var t=Laya.LocalStorage.getItem(e);try{var o=JSON.parse(t);if(o.expires){var n=(new Date).getTime();return o.expires>n?o.value:(this.RemoveLocalStorage(e),null)}return o.value}catch(i){return t}},e.prototype.RemoveLocalStorage=function(e){var t=Laya.LocalStorage.getItem(e);null!=t&&Laya.LocalStorage.removeItem(e)},e.prototype.ClearLocalStorage=function(){Laya.LocalStorage.clear()},e.prototype.SetSessionStorage=function(e,t,o){void 0===o&&(o=null);var n=new Date,i={expires:n.getTime()+24*o*3600*1e3,value:t};Laya.Browser.window.sessionStorage.setItem(e,JSON.stringify(i))},e.prototype.GetSessionStorage=function(e){var t=Laya.Browser.window.sessionStorage.getItem(e);try{var o=JSON.parse(t);if(o.expires){var n=(new Date).getTime();return o.expires>n?o.value:(this.RemoveLocalStorage(e),null)}return o.value}catch(i){return t}},e.prototype.RemoveSessionStorage=function(e){Laya.Browser.window.sessionStorage.removeItem(e)},e.prototype.ClearSessionStorage=function(){Laya.Browser.window.sessionStorage.clear()},e}();e.Storage=o}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.isArray=function(e){return"object"==typeof e?"[object Array]"===Object.prototype.toString.call(e):!1},e}();e.Check=t}(Utils||(Utils={}));var Net;!function(e){var t=function(){function t(){this.header={Authorization:""},this.http=new Utils.Http}return t.prototype.SetToken=function(e){return void 0===e&&(e=""),this.header.Authorization=e,!0},t.prototype.Login=function(t,o,n){var i={Code:t.Code,ParentID:t.ParentID,DeviceType:t.DeviceType,DeviceId:t.DeviceId};this.http.Post(e.ApiConfig.Login,i,null,function(e){console.log("Login成功回调"),e.Result==Enum.ErrorCode.Success?o.runWith(e.Data):n.runWith(e.Result)},function(e){console.log("Login失败回调"),n.runWith(e.toString())})},t.prototype.LoginCheck=function(t,o,n){var i={Authorization:t};this.http.Post(e.ApiConfig.LoginCheck,null,i,function(e){console.log("LoginCheck成功回调"),e.Result==Enum.ErrorCode.Success?o.runWith(e.Data):n.runWith(e.ErrorCode)},function(e){console.log("LoginCheck失败回调"),n.runWith(e.toString())})},t.prototype.LoginByID=function(t,o,n,i){var r={Authorization:t},a={MemberID:o.MemberID,DeviceType:o.DeviceType,DeviceId:o.DeviceId};this.http.Post(e.ApiConfig.LoginById,a,r,function(e){console.log("LoginCheck成功回调"),e.Result==Enum.ErrorCode.Success?n.runWith(e.Data):i.runWith(e.ErrorCode)},function(e){console.log("LoginCheck失败回调"),i.runWith(e.toString())})},t.prototype.GetMemberInfo=function(t,o){this.http.Post(e.ApiConfig.GetMemberInfo,null,this.header,function(e){console.log("GetMemberInfo成功回调"),e.Result==Enum.ErrorCode.Success?t.runWith(e.Data):o.runWith(e.ErrorCode)},function(e){console.log("GetMemberInfo失败回调"),o.runWith(e.toString())})},t.instance=new t,t}();e.WebApi=t}(Net||(Net={}));var Net;!function(e){var t;!function(e){e.Login=GameConfig.WebApiBaseUrl+"/Member/Login",e.LoginCheck=GameConfig.WebApiBaseUrl+"/Member/LoginByToken",e.LoginById=GameConfig.WebApiBaseUrl+"/Member/SelectMember",e.GetMemberInfo=GameConfig.WebApiBaseUrl+"/Member/GetUserProfile"}(t=e.ApiConfig||(e.ApiConfig={}))}(Net||(Net={}));var InitState=function(){function e(){Laya.init(GameConfig.DesignWidth,GameConfig.DesignHeight,Laya.WebGL),Laya.WorkerLoader.workerPath="libs/worker.js",Laya.WorkerLoader.enable=!0,Laya.stage.scaleMode=Laya.Stage.SCALE_EXACTFIT,Laya.stage.alignH=Laya.Stage.ALIGN_CENTER,Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE,Laya.stage.screenMode=Laya.Stage.SCREEN_HORIZONTAL,Config.isAntialias=!0,Laya.stage.bgColor="#8cb48e"}return e}(),Enum;!function(e){var t;!function(e){e[e.SystemError=0]="SystemError",e[e.Success=1]="Success",e[e.InvalidArgument=2]="InvalidArgument",e[e.MemberExist=1001]="MemberExist",e[e.MemberNotExist=1002]="MemberNotExist",e[e.MemberClosed=1003]="MemberClosed",e[e.NullToken=2001]="NullToken",e[e.OverTime=2002]="OverTime",e[e.TokenInvalid=2003]="TokenInvalid",e[e.TokenDecodeError=2004]="TokenDecodeError",e[e.SignatureError=2005]="SignatureError",e[e.PlayloadError=2006]="PlayloadError",e[e.AccountInvalid=2007]="AccountInvalid",e[e.RefuseTourist=2008]="RefuseTourist",e[e.MemberIdInvalid=2009]="MemberIdInvalid",e[e.AccountExist=3001]="AccountExist",e[e.AccountHasBeenSetup=3002]="AccountHasBeenSetup",e[e.AlreadyAgent=3003]="AlreadyAgent",e[e.EmailExist=3004]="EmailExist",e[e.ErrorPassword=3005]="ErrorPassword",e[e.ParentCanNotBeSelf=3006]="ParentCanNotBeSelf",e[e.PhoneNumberExist=3007]="PhoneNumberExist",e[e.SameEmail=3008]="SameEmail",e[e.SamePassword=3009]="SamePassword",e[e.SamePhoneNumber=3010]="SamePhoneNumber",e[e.WrongEmail=3011]="WrongEmail",e[e.WrongPhoneNumber=3012]="WrongPhoneNumber",e[e.AgencyRelationshipNotExist=3013]="AgencyRelationshipNotExist",e[e.ModifyMemberScoreFailed=3001]="ModifyMemberScoreFailed",e[e.ModifyParentScoreFailed=3002]="ModifyParentScoreFailed"}(t=e.ErrorCode||(e.ErrorCode={}))}(Enum||(Enum={}));var BaseDto;!function(e){var t=function(){function e(){this.Nickname="",this.Score=null,this.HeadImageUrl=""}return e}();e.MemberInfoDto=t}(BaseDto||(BaseDto={}));var BaseDto;!function(e){var t=function(){function e(){this.DeviceId="123456",this.DeviceType="MOBILE"}return e}();e.LoginDto=t;var o=function(){function e(){}return e}();e.LoginSuccessDto=o;var n=function(){function e(){}return e}();e.LoginMultiAccountDto=n;var i;!function(e){e[e.ERROR=0]="ERROR",e[e.LOGIN=1]="LOGIN",e[e.MULTI=2]="MULTI",e[e.NO=3]="NO"}(i=e.ResultEnum||(e.ResultEnum={}));var r=function(){function e(){}return e}();e.LoginResultDto=r}(BaseDto||(BaseDto={}));var BaseDto;!function(e){var t=function(){function e(){}return e}();e.MultiAccountDto=t;var o=function(){function e(){this.Token="",this.SocketToken="",this.Code=null,this.IsClose=!1,this.IsMulti=!1}return e}();e.AuthorizationDto=o}(BaseDto||(BaseDto={}));var CacheData;!function(){}(CacheData||(CacheData={}));var CacheData;!function(){}(CacheData||(CacheData={}));var CacheData;!function(e){var t=function(){function e(){this.authorization=null,this.cacheType=void 0!==GameConfig.CacheType?GameConfig.CacheType:Utils.StorageType.LOCALSTORAGE}return e.prototype.GetAuthorizationKey=function(e){return"Authorization-"+e+"-Key"},e.prototype.GetAuthorization=function(e){if(this.authorization)return this.authorization;var t=new Utils.Storage,o=this.GetAuthorizationKey(e);return this.authorization=t.Get(o,this.cacheType),this.authorization},e.prototype.SetAuthorization=function(e,t){this.authorization||(this.authorization=new BaseDto.AuthorizationDto),this.authorization.Code=void 0!==t.Code?t.Code:this.authorization.Code,this.authorization.SocketToken=void 0!==t.SocketToken?t.SocketToken:this.authorization.SocketToken,this.authorization.Token=void 0!==t.Token?t.Token:this.authorization.Token,this.authorization.IsMulti=void 0!==t.IsMulti?t.IsMulti:this.authorization.IsMulti,this.authorization.Accounts=void 0!==t.Accounts?t.Accounts:this.authorization.Accounts;var o=new Utils.Storage,n=this.GetAuthorizationKey(e);return o.Set(n,this.authorization,this.cacheType),!0},e.instance=new e,e}();e.Authorization=t}(CacheData||(CacheData={}));var CacheData;!function(e){var t=function(){function e(){this.memberInfo=null,this.cacheType=void 0!==GameConfig.CacheType?GameConfig.CacheType:Utils.StorageType.LOCALSTORAGE}return e.prototype.GetMemberInfoKey=function(e){return"MemberInfo-"+e+"-cache"},e.prototype.GetMemberInfo=function(e){if(this.memberInfo)return this.memberInfo;var t=new Utils.Storage,o=this.GetMemberInfoKey(e);return this.memberInfo=t.Get(o,this.cacheType),this.memberInfo},e.prototype.SetMemberInfo=function(e,t){this.memberInfo||(this.memberInfo=new BaseDto.MemberInfoDto),this.memberInfo.Account=void 0!==t.Account?t.Account:this.memberInfo.Account,this.memberInfo.HeadImageUrl=void 0!==t.HeadImageUrl?t.HeadImageUrl:this.memberInfo.HeadImageUrl,this.memberInfo.Nickname=void 0!==t.Nickname?t.Nickname:this.memberInfo.Nickname,this.memberInfo.Score=void 0!==t.Score?t.Score:this.memberInfo.Score,this.memberInfo.MemberId=void 0!==t.MemberId?t.MemberId:this.memberInfo.MemberId;var o=new Utils.Storage,n=this.GetMemberInfoKey(e);return o.Set(n,this.memberInfo,this.cacheType),!0},e.instance=new e,e}();e.MemberInfo=t}(CacheData||(CacheData={}));var MemberManager;!function(e){var t=function(){function e(){}return e.prototype.Login=function(e,t){this.handler=t,this.gameID=e.GameID;var o=CacheData.Authorization.instance.GetAuthorization(this.gameID);if(null!=o&&e.Code&&e.Code!=o.Code||null==o&&e.Code){var n=Laya.Handler.create(this,this.LoginSuccess,[e.Code]),i=Laya.Handler.create(this,this.LoginError);Net.WebApi.instance.Login(e,n,i)}else if(null!=o&&o.Token){var n=Laya.Handler.create(this,this.LoginSuccess,[e.Code]),i=Laya.Handler.create(this,this.LoginError);Net.WebApi.instance.LoginCheck(o.Token,n,i)}else{var r=new BaseDto.LoginResultDto;r.Result=BaseDto.ResultEnum.NO,this.handler.runWith(r)}},e.prototype.LoginByID=function(e,t){this.handler=t;var o=CacheData.Authorization.instance.GetAuthorization(this.gameID);if(null!=o&&o.Token){var n=Laya.Handler.create(this,this.LoginSuccess,[void 0]),i=Laya.Handler.create(this,this.LoginError);Net.WebApi.instance.LoginByID(o.Token,e,n,i)}else{var r=new BaseDto.LoginResultDto;r.Result=BaseDto.ResultEnum.NO,this.handler.runWith(r)}},e.prototype.LoginSuccess=function(e,t){console.log("LoginSuccess",e,t);var o=new BaseDto.AuthorizationDto;if(o.Code=e,t.Accounts){o.IsMulti=!0,o.Token=t.TempToken,o.SocketToken=null,o.Accounts=t.Accounts,CacheData.Authorization.instance.SetAuthorization(this.gameID,o);var n=new BaseDto.LoginResultDto;n.Result=BaseDto.ResultEnum.MULTI,n.Data=o.Accounts,this.handler.runWith(n)}else{o.Token=t.SessionToken,o.SocketToken=t.SocketToken,o.IsMulti=!1,o.IsClose=t.Closed,Net.WebApi.instance.SetToken(o.Token),CacheData.Authorization.instance.SetAuthorization(this.gameID,o);var n=new BaseDto.LoginResultDto;n.Result=BaseDto.ResultEnum.LOGIN,this.handler.runWith(n)}},e.prototype.LoginError=function(e){console.log("LoginError",e);var t=new BaseDto.LoginResultDto;t.Result=BaseDto.ResultEnum.ERROR,t.Data=e,this.handler.runWith(t)},e.prototype.GetMemberInfo=function(e,t){var o=CacheData.Authorization.instance.GetAuthorization(e);return o.IsMulti?(t.runWith(o.Accounts),void 0):(Net.WebApi.instance.GetMemberInfo(Laya.Handler.create(this,function(o){console.log("GetMemberInfo",o),CacheData.MemberInfo.instance.SetMemberInfo(e,o),t.runWith(o)}),Laya.Handler.create(this,this.LoginError)),void 0)},e}();e.Member=t}(MemberManager||(MemberManager={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(e){var t=function(t){function o(){return t.call(this)||this}return __extends(o,t),o.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.AccountListUI.uiView)},o.uiView={type:"View",props:{width:1334,height:750},child:[{type:"List",props:{y:151,x:0,width:1334,visible:!1,"var":"accountList",repeatY:6,repeatX:1,height:433},child:[{type:"Box",props:{y:0,x:0,width:1334,renderType:"render",height:72},child:[{type:"Label",props:{y:0,x:409,width:677,valign:"middle",text:"账号：                      代理： ",padding:"0,10,0,10",name:"item",mouseEnabled:!0,height:72,fontSize:36,color:"#338fff",borderColor:"#fff45c",align:"left"},child:[{type:"Label",props:{y:0,x:105,width:220,valign:"middle",text:"label",overflow:"hidden",name:"account",height:72,fontSize:36,color:"#338fff",align:"left"}},{type:"Label",props:{y:0,x:424,width:220,valign:"middle",text:"label",overflow:"hidden",name:"agent",height:72,fontSize:36,color:"#338fff",align:"left"}}]}]}]},{type:"Label",props:{y:375,x:667,visible:!0,"var":"login",text:"登录中...",fontSize:36,color:"#338fff",cacheAs:"bitmap",bold:!0,anchorY:.5,anchorX:.5}}]},o}(View);e.AccountListUI=t}(ui||(ui={}));var GameMain=function(){function e(){this.memberServer=new MemberManager.Member,this.dto=new BaseDto.LoginDto;new InitState;this.accountUI=new ui.AccountListUI,Laya.stage.addChild(this.accountUI),this.dto.Code=Utils.Url.GetQuery("code"),this.dto.ParentID=Utils.Url.GetQuery("parentID"),this.dto.GameID=Utils.Url.GetQuery("gameID");var e=Utils.Url.GetQuery("testID");e||this.memberServer.Login(this.dto,Laya.Handler.create(this,this.LoginCallback))}return e.prototype.LoginCallback=function(e){e.Result==BaseDto.ResultEnum.LOGIN?this.memberServer.GetMemberInfo(this.dto.GameID,Laya.Handler.create(this,this.Redirect)):e.Result==BaseDto.ResultEnum.MULTI?this.MultiAccount(e.Data):e.Result==BaseDto.ResultEnum.ERROR?this.Redirect():e.Result==BaseDto.ResultEnum.NO&&this.Redirect()},e.prototype.Redirect=function(){this.accountUI.login.visible=!1,this.dto.GameID?Laya.Browser.window.location.replace(GameConfig.GetRedirectUrl(this.dto.GameID)):alert("游戏不存在")},e.prototype.MultiAccount=function(e){this.list=e,this.accountUI.accountList.array=e,this.accountUI.accountList.mouseHandler=Laya.Handler.create(this,this.onSelect),this.accountUI.accountList.vScrollBarSkin="",this.accountUI.accountList.renderHandler=Laya.Handler.create(this,this.renderHandler,null,!1),this.accountUI.login.visible=!1,this.accountUI.accountList.visible=!0},e.prototype.renderHandler=function(e,t){if(!(t>this.list.length)){var o=this.list[t],n=e.getChildByName("item"),i=n.getChildByName("account");i.text=o.Account;var r=e.getChildByName("item").getChildByName("agent");r.text=o.ParentNickname}},e.prototype.onSelect=function(e,t){this.accountUI.login.visible=!0,this.accountUI.accountList.visible=!1,this.dto.MemberID=this.list[t].MemberId,this.memberServer.LoginByID(this.dto,Laya.Handler.create(this,this.LoginCallback))},e}();new GameMain;