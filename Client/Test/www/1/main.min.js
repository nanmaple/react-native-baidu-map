var TipsPanelCtrl=function(){function t(t){this.statedPanel=t}return t.prototype.Show=function(){this.statedPanel.ShowTip()},t}(),RoundPanelCtrl=function(){function t(t){this.statedPanel=t}return t.prototype.SetGameRound=function(t){this.statedPanel.SetGameRound(t)},t.prototype.SetGameState=function(t){this.statedPanel.SetGameState(t)},t}(),BetPanelCtrl=function(){function t(t,e,n,o){this.chip=5,this.lastBetPosMsg=new Object,this.currentBetPosMsg=new Array,this.currentOdds=new Object,this.sendBetPosMsg=new Object,this.currentBetSocre=0,this.handler=e,this.isClose=n,this.betPanel=t,this.betPanel.SetClickHandelr(Laya.Handler.create(this,this.BtnClickHandler,null,!1)),o&&o.Score&&(this.balance=Number(o.Score)),this.isClose&&this.betPanel.DisabledAllBtn()}return t.prototype.SetOdds=function(t){this.currentOdds=t,this.betPanel.SetOdds(t)},t.prototype.GameInit=function(t){this.SetOdds(t.Odds),this.limitScore=t.Limit,t.Status!=BaseEnum.GameStatus.BET||this.isClose?(this.betPanel.GameResult(this.lastBetPosMsg,this.currentBetPosMsg,t.Limit),this.betPanel.SetBetting(!1)):(this.lastBetPosMsg=t.TotalBet,this.betPanel.GameInit(this.lastBetPosMsg,t.Limit),this.betPanel.SetBetting(!0))},t.prototype.GameStart=function(t){this.betPanel.ResetBetBtnLabel(),this.betPanel.SetBetting(!0),this.isClose||(this.betPanel.SetBetBtn(!1),this.SetOdds(t),Laya.timer.loop(5e3,this,this.ReSend))},t.prototype.BetAck=function(t){this.sendBetPosMsg[t]&&(this.sendBetPosMsg[t]=null)},t.prototype.BetResult=function(t){if(!this.isClose)if(t.Success)this.balance=t.Balance,this.lastBetPosMsg=t.TotalBet,this.betPanel.SetBetPos(this.lastBetPosMsg),this.betPanel.ShowMsg("投注成功");else{var e=t.ErrorCode.toString();this.betPanel.ShowMsg(e),this.betPanel.SetBetPos(this.lastBetPosMsg)}},t.prototype.GameResult=function(){this.isClose||(this.betPanel.SetBetting(!1),this.betPanel.DisabledAllBtn(),this.sendBetPosMsg=new Object,this.betPanel.GameResult(this.lastBetPosMsg,this.currentBetPosMsg),this.currentBetPosMsg=new Array,this.currentBetSocre=0)},t.prototype.SettleResult=function(t){this.isClose||(this.balance=t.Balance,this.betPanel.SettleResult(t),this.lastBetPosMsg=new Object)},t.prototype.BtnClickHandler=function(t){switch(t.Type){case ScenePanel.ClickType.ODDS:this.BetPosType(t.Data);break;case ScenePanel.ClickType.BET:this.BetConfirm();break;case ScenePanel.ClickType.CANCEL:this.BetCancel();break;case ScenePanel.ClickType.CHIP:this.ChangeChip(t.Data)}},t.prototype.BetPosType=function(t){var e=this.currentBetPosMsg.length,n=!1,o=0;this.lastBetPosMsg&&this.lastBetPosMsg.hasOwnProperty(t)&&(o+=this.lastBetPosMsg[t]);for(var r=0;e>r;r++)if(this.currentBetPosMsg[r].BetPos==t){n=!0;var s=this.currentBetPosMsg[r].Amount+this.chip;if(o+=s,this.limitScore.MinBet<=o&&o<=this.limitScore.MaxBet){var i=this.currentBetSocre+this.chip;if(i>this.balance)return this.betPanel.ShowMsg("余额不足"),void 0;this.currentBetSocre=i,this.currentBetPosMsg[r].Amount=s,this.betPanel.ChipsFly(t-1,o)}else if(o>this.limitScore.MaxBet){var a=this.limitScore.MaxBet-(o-this.chip);if(0>=a)return this.betPanel.ShowMsg("超过投注限额"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||this.betPanel.DisabledBetBtn(),void 0;var i=this.currentBetSocre+a;if(i>this.balance)return this.betPanel.ShowMsg("余额不足"),void 0;this.currentBetSocre=i,this.currentBetPosMsg[r].Amount=this.limitScore.MaxBet,this.betPanel.ChipsFly(t-1,this.limitScore.MaxBet)}break}if(!n){var l=new Dto.BetDto;if(l.BetPos=t,o+=this.chip,this.limitScore.MinBet<=o&&o<=this.limitScore.MaxBet){var i=this.currentBetSocre+this.chip;if(i>this.balance)return this.betPanel.ShowMsg("余额不足"),void 0;this.currentBetSocre=i,l.Odds=this.currentOdds[t],l.Amount=this.chip,this.currentBetPosMsg.push(l),this.betPanel.ChipsFly(t-1,o)}else if(o>this.limitScore.MaxBet){var a=this.limitScore.MaxBet-(o-this.chip);if(0>=a)return this.betPanel.ShowMsg("超过投注限额"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||this.betPanel.DisabledBetBtn(),void 0;var i=this.currentBetSocre+a;if(i>this.balance)return this.betPanel.ShowMsg("余额不足"),void 0;this.currentBetSocre=i,l.Amount=a,l.Odds=this.currentOdds[t],this.currentBetPosMsg.push(l),this.betPanel.ChipsFly(t-1,this.limitScore.MaxBet)}}this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||this.betPanel.DisabledBetBtn()},t.prototype.BetConfirm=function(){if(!this.isClose&&this.currentBetPosMsg&&0!==this.currentBetPosMsg.length){var t=new Dto.HandlerDto;t.MsgID=null,t.Data=this.currentBetPosMsg,this.handler.runWith(t)}},t.prototype.SetMsgID=function(t){this.sendBetPosMsg[t]=this.currentBetPosMsg,this.currentBetPosMsg=new Array,this.currentBetSocre=0},t.prototype.BetCancel=function(){this.isClose||(this.currentBetPosMsg=new Array,this.currentBetSocre=0,this.betPanel.SetBetPos(this.lastBetPosMsg))},t.prototype.ChangeChip=function(t){this.isClose||(this.chip=t)},t.prototype.ReSend=function(){for(var t in this.sendBetPosMsg)if(this.sendBetPosMsg[t]){var e=new Dto.HandlerDto;e.MsgID=t,e.Data=this.sendBetPosMsg[t],this.handler.runWith(e)}},t}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),CardPanelCtrl=function(t){function e(e,n){var o=t.call(this)||this;return o.pokerNum=3,o.cardPanel=e,o.footBallPanel=n,o}return __extends(e,t),e.prototype.InitGame=function(t){this.dataCards=[t.FirstCard,t.SecondCard,t.ThirdCard];for(var e=0;e<this.pokerNum;e++)this.cardPanel.pokerCards[e].InitPoker(this.dataCards[e])},e.prototype.StartGame=function(t){this.dataCards=[t.FirstCard,t.SecondCard,null];for(var e=0;e<this.pokerNum;e++)this.cardPanel.pokerCards[e].ShowPoker(this.dataCards[e])},e.prototype.EndGame=function(t){var e=this;this.dataCards=[t.FirstCard,t.SecondCard,t.ThirdCard],this.cardPanel.pokerCards[2].StartFlipPoker(t.ThirdCard),Laya.timer.once(2e3,this,function(){for(var t=0;t<e.pokerNum;t++)e.cardPanel.pokerCards[t].HidePoker();e.FootBallAnimation(e.dataCards),e.endGameHander.run()})},e.prototype.EndGameHander=function(t){this.endGameHander=t},e.prototype.FootBallAnimation=function(t){var e=Utils.Poker.GetNumber(t[0]),n=Utils.Poker.GetNumber(t[1]),o=Utils.Poker.GetNumber(t[2]);(o>e&&n>o||e>o&&o>n)&&this.footBallPanel.ShootIn(),(e>o&&n>o&&(n>e||e==n)||o>e&&o>n&&e>n)&&this.footBallPanel.ShootLeft(),(o>e&&o>n&&(n>e||e==n)||e>o&&n>o&&e>n)&&this.footBallPanel.ShootRight(),(o==e||o==n)&&this.footBallPanel.ShootGoalPost()},e}(Laya.Sprite),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),GameCtrl=function(t){function e(e){var n=t.call(this,GameConfig.GameID)||this;if(n.onClose=e,n.gameScenes=new ScenePanel.GameScenes,Net.WebApi.instance.SetToken(),n.RoundPanelCtrl=new RoundPanelCtrl(n.gameScenes.roundPanel),n.CardPanelCtrl=new CardPanelCtrl(n.gameScenes.cardPanel,n.gameScenes.footballPanel),n.BetCtrl=new BetPanelCtrl(n.gameScenes.betPanel,Laya.Handler.create(n,n.SendHandelr,null,!1),n.authorizationInfo.IsClose,n.memberInfo),n.HistoryPanelCtrl=new HistoryPanelCtrl(n.gameScenes.historyPanel),n.TimePanelCtrl=new TimePanelCtrl(n.gameScenes.timePanel),n.HeadPanelCtrl=new HeadPanelCtrl(n.gameScenes.headPanel,n.gameScenes.noteReocrdPanel,n.gameScenes.rulePanel,n.memberInfo,n.parentID),!n.memberInfo){var o=new TipsPanelCtrl(n.gameScenes.tipsPanel);o.Show()}return n}return __extends(e,t),e.prototype.OnConnectHandler=function(){console.log("侦听:Socket连接")},e.prototype.OnCloseHandler=function(){console.log("侦听:Socket关闭")},e.prototype.OnErrorHandler=function(){console.log("侦听:Socket错误")},e.prototype.OnWillReconnectHandler=function(){console.log("侦听:Socket重连")},e.prototype.OnLogoutHandler=function(){console.log("侦听:登出")},e.prototype.OnAckHandler=function(t){console.log("侦听:Ack"),this.BetCtrl.BetAck(t)},e.prototype.OnSystemPushHandler=function(){},e.prototype.SendHandelr=function(t){var e=t.MsgID?t.MsgID:Utils.Guid.Create();this.BetCtrl.SetMsgID(e),this.Send(t.Data,e)},e.prototype.OnGameInit=function(t){t&&t.RoundID&&this.RoundPanelCtrl.SetGameRound(t.RoundID),0==t.Status&&this.RoundPanelCtrl.SetGameState(0),1==t.Status&&t.BetTime>=0&&(this.TimePanelCtrl.StartGameTime(t.BetTime),this.RoundPanelCtrl.SetGameState(1)),t&&this.BetCtrl.GameInit(t),t&&t.Cards&&this.CardPanelCtrl.InitGame(t.Cards),t&&t.History&&this.HistoryPanelCtrl.SetHistoryData(t.History),t&&t.Limit&&this.HistoryPanelCtrl.SetLimit(t.Limit),console.log("MSG:游戏初始化",t)},e.prototype.OnGameStart=function(t){t&&t.RoundID&&this.RoundPanelCtrl.SetGameRound(t.RoundID),this.RoundPanelCtrl.SetGameState(1),console.log("MSG:游戏开始",t),t&&t.Odds&&this.BetCtrl.GameStart(t.Odds),t&&t.BetTime&&this.TimePanelCtrl.StartGameTime(t.BetTime),this.CardPanelCtrl.StartGame(t)},e.prototype.OnBetResult=function(t){console.log("MSG:游戏投注结果",t),this.BetCtrl.BetResult(t),!this.authorizationInfo.IsClose&&t.Success&&this.HeadPanelCtrl.ChangeMoney(t.Balance)},e.prototype.OnStopBet=function(){console.log("MSG:游戏停止投注")},e.prototype.OnGameResult=function(t){var e=this;this.RoundPanelCtrl.SetGameState(2),console.log("MSG:游戏结束",t),this.BetCtrl.GameResult(),this.CardPanelCtrl.EndGame(t),this.TimePanelCtrl.EndGameTime(),this.CardPanelCtrl.EndGameHander(Laya.Handler.create(this,function(){e.HistoryPanelCtrl.AddHistoryList(t)}))},e.prototype.OnSettleResult=function(t){this.RoundPanelCtrl.SetGameState(3),console.log("MSG:游戏结算",t),this.BetCtrl.SettleResult(t),this.authorizationInfo.IsClose||this.HeadPanelCtrl.ChangeMoney(t.Balance)},e.prototype.OnGameOther=function(t){console.log("MSG:游戏其他信息",t)},e}(BaseCtrl),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ScenePanel;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.onGameLoadSuccess=t,n.onLoaded(),n}return __extends(n,e),n.prototype.onLoaded=function(){this.gameLoadScenes=new t.GameLoadScenes,Laya.stage.addChild(this.gameLoadScenes);var e=t.LoadResourcesConfig;Laya.loader.load(e,Laya.Handler.create(this,this.onLoadResource),Laya.Handler.create(this,this.onProgress,null,!1))},n.prototype.onProgress=function(t){this.gameLoadScenes.LoadProgress(t)},n.prototype.onLoadResource=function(){this.onGameLoadSuccess.run()},n}(Laya.Sprite);t.GameLoadCtrl=e}(ScenePanel||(ScenePanel={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),HeadPanelCtrl=function(t){function e(e,n,o,r,s){var i=t.call(this)||this;i.headPanel=e;var a=Laya.Handler.create(i,i.OnClickGR,null,!1),l=Laya.Handler.create(i,i.OnClickRule,null,!1);return i.headPanel.SetInfo(r,s,a,l),i.noteRecordPanelCtrl=new NoteRecordPanelCtrl(n),i.rulePanel=o,i}return __extends(e,t),e.prototype.OnClickGR=function(){this.noteRecordPanelCtrl.ShowNoteRecord()},e.prototype.OnClickRule=function(){this.rulePanel.ShowRule()},e.prototype.ChangeMoney=function(t){this.headPanel.ChangeMoney(Math.floor(t))},e}(Laya.Sprite),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),HistoryPanelCtrl=function(t){function e(e){var n=t.call(this)||this;return n.index=0,n.historyPanel=e,n}return __extends(e,t),e.prototype.GetPokerUrl=function(t){return"ui/poker/"+t+".png"},e.prototype.SetHistoryData=function(t){if(this.listArr=[],t){this.index=t.length;for(var e=0;e<this.index;e++){var n={poker0:{skin:this.GetPokerUrl(t[e].FirstCard)},poker1:{skin:this.GetPokerUrl(t[e].SecondCard)},poker2:{skin:this.GetPokerUrl(t[e].ThirdCard)}};this.listArr.unshift(n)}this.historyPanel._list.array=this.listArr,this.historyPanel._list.renderHandler=new Laya.Handler(this,this.onRender)}},e.prototype.onRender=function(t,e){if(!(e>this.listArr.length)){var n=this.listArr[e],o=t.getChildByName("poker0"),r=t.getChildByName("poker1"),s=t.getChildByName("poker2");o.skin=n.poker0.skin,r.skin=n.poker1.skin,s.skin=n.poker2.skin}},e.prototype.AddHistoryList=function(t){var e={poker0:{skin:this.GetPokerUrl(t.FirstCard)},poker1:{skin:this.GetPokerUrl(t.SecondCard)},poker2:{skin:this.GetPokerUrl(t.ThirdCard)}};this.listArr.unshift(e),this.historyPanel._list.array=this.listArr},e.prototype.SetLimit=function(t){this.historyPanel.SetLimit(t)},e}(Laya.Sprite),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),LoadingrPanelCtrl=function(t){function e(e){var n=t.call(this)||this;return n.onClose=e,n}return __extends(e,t),e}(Laya.Sprite),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),NoteRecordPanelCtrl=function(t){function e(e){var n=t.call(this)||this;return n.noMoreData=!1,n.scrollValue=0,n.listShow=!1,n.noteRecordPanel=e,n.betRecordPageDto=new Dto.BetRecordPageDto,n.betRecordPageDto.GameId=GameConfig.GameID,n.betRecordPageDto.PageSize=10,n.noteRecordPanel.on("OnMouseDown",n,n.OnMouseDown),n.noteRecordPanel.on("OnMouseUp",n,n.OnMouseUp),n.noteRecordPanel.CloseRecordHander(new Laya.Handler(n,n.CloseNoteRecord)),n}return __extends(e,t),e.prototype.OnMouseDown=function(){this.mouseDownY=this.mouseY},e.prototype.OnMouseUp=function(){0==this.scrollValue&&this.mouseY-this.mouseDownY>100&&this.DownRefresh(),this.noMoreData||this.scrollValue>=this.dataArr.length*this.listBoxH-this.recordListH&&this.mouseDownY-this.mouseY>100&&this.UpLoading()},e.prototype.ShowNoteRecord=function(){Net.WebApi.instance.SetToken(GameConfig.DebugToken),this.DownRefresh(),this.noteRecordPanel._recordList.vScrollBarSkin=""},e.prototype.CloseNoteRecord=function(){this.dataArr=[],this.noteRecordPanel._recordList.dataSource=this.dataArr,this.ClearTextureRes()},e.prototype.ClearTextureRes=function(){Laya.loader.clearTextureRes("ui/mask.png"),Laya.loader.clearTextureRes("ui/bg_record.png"),Laya.loader.clearTextureRes("ui/recordLine.png")},e.prototype.GetNoteRecordData=function(t){this.listShow=!0,this.noteRecordPanel.ShowNoteRecord(this.listShow),this.listArr=[],this.index=t.length;for(var e=0;e<this.index;e++){var n={betTime:{text:Utils.Time.transform(t[e].BetTime,1)},betDate:{text:Utils.Time.transform(t[e].BetTime,0)},bureauNum:{text:t[e].GameData[t[e].GameData.length-1].TransferID},betResult:{text:this.BetResult(t[e].Total)},gameData:t[e].GameData,total:t[e].Total};this.listArr.push(n)}this.dataArr=this.dataArr.concat(this.listArr),this.noteRecordPanel._recordList.array=this.dataArr,this.noteRecordPanel._recordList.renderHandler=new Laya.Handler(this,this.onRender),this.noteRecordPanel._recordList.mouseHandler=new Laya.Handler(this,this.onMouse)},e.prototype.Success=function(t){for(var e=t.Data,n=0;n<e.length;n++)e[n].GameData=JSON.parse(e[n].GameData);return e&&0!=e.length?(this.GetNoteRecordData(e),this.betRecordPageDto.LastId=e[e.length-1].Id,void 0):(this.noMoreData=!0,void 0)},e.prototype.Error=function(t){console.log(t)},e.prototype.UpLoading=function(){Net.WebApi.instance.GetBetRecord(this.betRecordPageDto,Laya.Handler.create(this,this.Success,null,!1),Laya.Handler.create(this,this.Error,null,!1))},e.prototype.DownRefresh=function(){this.betRecordPageDto.LastId=null,this.noMoreData=!1,this.dataArr=[],this.listShow=!1,this.noteRecordPanel.ShowNoteRecord(this.listShow),Net.WebApi.instance.GetBetRecord(this.betRecordPageDto,Laya.Handler.create(this,this.Success,null,!1),Laya.Handler.create(this,this.Error,null,!1))},e.prototype.onRender=function(t,e){if(!(e>this.dataArr.length)){var n=this.dataArr[e];this.listBoxH=t.height,this.recordListH=this.noteRecordPanel._recordList.height;var o=t.getChildByName("betTime"),r=t.getChildByName("betDate"),s=t.getChildByName("bureauNum"),i=t.getChildByName("betResult");o.text=n.betTime.text,r.text=n.betDate.text,s.text=n.bureauNum.text,i.text=n.betResult.text}},e.prototype.onMouse=function(t,e){if(this.scrollValue=this.noteRecordPanel._recordList.scrollBar.value,t.type==Laya.Event.CLICK){var n=this.dataArr[e];this.noteRecordPanel.GoNoteRecordDetail(n)}},e.prototype.BetResult=function(t){return t>0?"赢":"输"},e}(Laya.Sprite),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),PromptPanelCtrl=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(Laya.Sprite),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),TimePanelCtrl=function(t){function e(e){var n=t.call(this)||this;return n.timePanel=e,n}return __extends(e,t),e.prototype.StartGameTime=function(t){this.timePanel.timeEffect.StartGameTime(t),this.pos(1190,100)},e.prototype.EndGameTime=function(){this.timePanel.timeEffect.EndGameTime()},e}(Laya.Sprite),GameMain=function(){function t(){new InitState,new ScenePanel.GameLoadCtrl(Laya.Handler.create(this,this.onGameLoadSuccess))}return t.prototype.onGameLoadSuccess=function(){this.GameCtrl=new GameCtrl(Laya.Handler.create(this,this.onGameLoadSuccess))},t}(),gameMain=new GameMain;