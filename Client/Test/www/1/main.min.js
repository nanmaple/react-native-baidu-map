var TipsPanelCtrl=function(){function e(){}return e.prototype.Show=function(){ScenePanel.GameUI.GetInstance().GetTipsPanel().ShowTip()},e}(),RoundPanelCtrl=function(){function e(){}return e.prototype.SetGameRound=function(e){ScenePanel.GameUI.GetInstance().GetRoundPanel().SetGameRound(e)},e.prototype.SetGameState=function(e){ScenePanel.GameUI.GetInstance().GetRoundPanel().SetGameState(e)},e}(),BetPanelCtrl=function(){function e(e,t,n){this.chip=5,this.lastBetPosMsg=new Object,this.currentBetPosMsg=new Array,this.currentOdds=new Object,this.sendBetPosMsg=new Object,this.currentBetSocre=0,this.handler=e,this.isClose=t,ScenePanel.GameUI.GetInstance().GetBetPanel().SetClickHandelr(Laya.Handler.create(this,this.BtnClickHandler,null,!1)),n&&n.Score&&(this.balance=Number(n.Score)),ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledAllBtn()}return e.prototype.SetOdds=function(e){this.currentOdds=e,ScenePanel.GameUI.GetInstance().GetBetPanel().SetOdds(e)},e.prototype.GameInit=function(e,t){void 0===t&&(t=!1),t||(this.currentBetPosMsg=new Array),this.SetOdds(e.Odds),this.limitScore=e.Limit,ScenePanel.GameUI.GetInstance().GetBetPanel().SetLimit(e.Limit),e.Status!=BaseEnum.GameStatus.BET||this.isClose||(this.lastBetPosMsg=e.TotalBet),ScenePanel.GameUI.GetInstance().GetBetPanel().GameInit(this.lastBetPosMsg,this.currentBetPosMsg,!0)},e.prototype.GameStart=function(e){this.currentBetPosMsg=new Array,this.lastBetPosMsg=new Object,this.currentBetSocre=0,ScenePanel.GameUI.GetInstance().GetBetPanel().ClearFlyChip(),ScenePanel.GameUI.GetInstance().GetBetPanel().ResetBetBtnLabel(),ScenePanel.GameUI.GetInstance().GetBetPanel().SetBetting(!0),this.SetOdds(e),this.isClose||(ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetPanel(!1),Laya.timer.loop(5e3,this,this.ReSend))},e.prototype.BetAck=function(e){this.sendBetPosMsg[e]&&(this.sendBetPosMsg[e]=null)},e.prototype.BetResult=function(e){if(!this.isClose)if(e.Success)this.balance=e.Balance,this.lastBetPosMsg=e.TotalBet,ScenePanel.GameUI.GetInstance().GetBetPanel().SetBetPos(this.lastBetPosMsg),ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg("投注成功");else{var t=new LanguageUtils.Language,n=t.GetLanguage(BaseEnum.BetErrorCode[e.ErrorCode],GameConfig.GameID);ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg(n),ScenePanel.GameUI.GetInstance().GetBetPanel().SetBetPos(this.lastBetPosMsg)}},e.prototype.GameResult=function(){this.isClose||(ScenePanel.GameUI.GetInstance().GetBetPanel().SetBetting(!1),ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledAllBtn(),this.sendBetPosMsg=new Object,ScenePanel.GameUI.GetInstance().GetBetPanel().GameResult(this.lastBetPosMsg),this.currentBetPosMsg=new Array,this.currentBetSocre=0)},e.prototype.SettleResult=function(e){this.isClose||(this.balance=e.Balance,ScenePanel.GameUI.GetInstance().GetBetPanel().SettleResult(e,this.lastBetPosMsg),this.lastBetPosMsg=new Object)},e.prototype.BtnClickHandler=function(e){switch(e.Type){case ScenePanel.ClickType.ODDS:this.BetPosType(e.Data);break;case ScenePanel.ClickType.BET:this.BetConfirm();break;case ScenePanel.ClickType.CANCEL:this.BetCancel();break;case ScenePanel.ClickType.CHIP:this.ChangeChip(e.Data)}},e.prototype.BetPosType=function(e){var t=this.currentBetPosMsg.length,n=!1;if(0!=this.currentOdds[e]){var a=0;this.lastBetPosMsg&&this.lastBetPosMsg.hasOwnProperty(e)&&(a+=this.lastBetPosMsg[e]);for(var o=0;t>o;o++)if(this.currentBetPosMsg[o].BetPos==e){n=!0;var r=this.currentBetPosMsg[o].Amount+this.chip;if(a+=r,this.limitScore.MinBet<=a&&a<=this.limitScore.MaxBet){var s=this.currentBetSocre+this.chip;if(s>this.balance)return ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg("余额不足"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetBtn(),void 0;this.currentBetSocre=s,this.currentBetPosMsg[o].Amount=r,ScenePanel.GameUI.GetInstance().GetBetPanel().ChipsFly(e-1,a)}else if(a>this.limitScore.MaxBet){var i=this.limitScore.MaxBet-(a-this.chip);if(0>=i)return ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg("超过投注限额"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetBtn(),void 0;var s=this.currentBetSocre+i;if(s>this.balance)return ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg("余额不足"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetBtn(),void 0;this.currentBetSocre=s,this.currentBetPosMsg[o].Amount=this.limitScore.MaxBet,ScenePanel.GameUI.GetInstance().GetBetPanel().ChipsFly(e-1,this.limitScore.MaxBet)}break}if(!n){var c=new Dto.BetDto;if(c.BetPos=e,a+=this.chip,this.limitScore.MinBet<=a&&a<=this.limitScore.MaxBet){var s=this.currentBetSocre+this.chip;if(s>this.balance)return ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg("余额不足"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetBtn(),void 0;this.currentBetSocre=s,c.Odds=this.currentOdds[e],c.Amount=this.chip,this.currentBetPosMsg.push(c),ScenePanel.GameUI.GetInstance().GetBetPanel().ChipsFly(e-1,a)}else if(a>this.limitScore.MaxBet){var i=this.limitScore.MaxBet-(a-this.chip);if(0>=i)return ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg("超过投注限额"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetBtn(),void 0;var s=this.currentBetSocre+i;if(s>this.balance)return ScenePanel.GameUI.GetInstance().GetBetPanel().ShowMsg("余额不足"),this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetBtn(),void 0;this.currentBetSocre=s,c.Amount=i,c.Odds=this.currentOdds[e],this.currentBetPosMsg.push(c),ScenePanel.GameUI.GetInstance().GetBetPanel().ChipsFly(e-1,this.limitScore.MaxBet)}}this.currentBetPosMsg&&0!=this.currentBetPosMsg.length||ScenePanel.GameUI.GetInstance().GetBetPanel().DisabledBetBtn()}},e.prototype.BetConfirm=function(){if(!this.isClose&&this.currentBetPosMsg&&0!==this.currentBetPosMsg.length){var e=new Dto.HandlerDto;e.MsgID=null,e.Data=this.currentBetPosMsg,this.handler.runWith(e)}},e.prototype.SetMsgID=function(e){var t=new Dto.SendBetDto;t.Time=(new Date).getTime(),t.Data=this.currentBetPosMsg,this.sendBetPosMsg[e]=t,this.currentBetPosMsg=new Array,this.currentBetSocre=0},e.prototype.BetCancel=function(){this.isClose||(this.currentBetPosMsg=new Array,this.currentBetSocre=0,ScenePanel.GameUI.GetInstance().GetBetPanel().SetBetPos(this.lastBetPosMsg))},e.prototype.ChangeChip=function(e){this.isClose||(this.chip=e)},e.prototype.ReSend=function(){var e=(new Date).getTime();for(var t in this.sendBetPosMsg)if(this.sendBetPosMsg[t]){var n=(e-this.sendBetPosMsg[t].Time)/1e3;if(n>=5){var a=new Dto.HandlerDto;a.MsgID=t,a.Data=this.sendBetPosMsg[t].Data,this.handler.runWith(a)}}},e}(),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),CardPanelCtrl=function(e){function t(){var t=e.call(this)||this;return t.pokerNum=3,t.gameUI=ScenePanel.GameUI.GetInstance(),t}return __extends(t,e),t.prototype.InitGame=function(e){if(null==e.Cards||0==e.BetTime)console.log("游戏初始化隐藏牌",(new Date).getTime()),this.HidePoker();else{this.dataCards=[e.Cards.FirstCard,e.Cards.SecondCard,e.Cards.ThirdCard],console.log("游戏初始化隐藏-显示牌",(new Date).getTime());for(var t=0;t<this.pokerNum;t++)this.gameUI.GetCardPanel().HidePoker(t),this.gameUI.GetCardPanel().InitPoker(this.dataCards[t],t)}},t.prototype.HidePoker=function(){for(var e=0;e<this.pokerNum;e++)this.gameUI.GetCardPanel().HidePoker(e)},t.prototype.StartGame=function(e){this.dataCards=[e.FirstCard,e.SecondCard,null],console.log("游戏开始隐藏-显示牌",(new Date).getTime());for(var t=0;t<this.pokerNum;t++)this.gameUI.GetCardPanel().HidePoker(t),this.gameUI.GetCardPanel().ShowPoker(this.dataCards[t],t)},t.prototype.ClearPokerFlip=function(){this.gameUI.GetCardPanel().ClearPokerTween(),console.log(this.roundID)},t.prototype.EndGame=function(e){var t=this;this.dataCards=[e.FirstCard,e.SecondCard,e.ThirdCard];var n=new Dto.CardInfoDto;n.FirstCard=e.FirstCard,n.SecondCard=e.SecondCard,n.ThirdCard=e.ThirdCard,this.gameUI.GetCardPanel().StartFlipPoker(e.ThirdCard,2),this.gameUI.GetCardPanel().EndFlipPokerHander(Laya.Handler.create(this,function(){console.log("游戏结束隐藏牌",(new Date).getTime());for(var a=0;a<t.pokerNum;a++)t.gameUI.GetCardPanel().HidePoker(a);t.endGameHander.runWith({RoundID:e.RoundID,Cards:n}),t.FootBallAnimation(t.dataCards)}))},t.prototype.EndGameHander=function(e){this.endGameHander=e},t.prototype.ClearFootBallAnimation=function(){this.gameUI.GetFootBallPanel().ClearTween()},t.prototype.FootBallAnimation=function(e){var t=Utils.Poker.GetNumber(e[0]),n=Utils.Poker.GetNumber(e[1]),a=Utils.Poker.GetNumber(e[2]);(a>t&&n>a||t>a&&a>n)&&this.gameUI.GetFootBallPanel().ShootIn(),(t>a&&n>a&&(n>t||t==n)||a>t&&a>n&&t>n)&&this.gameUI.GetFootBallPanel().ShootLeft(),(a>t&&a>n&&(n>t||t==n)||t>a&&n>a&&t>n)&&this.gameUI.GetFootBallPanel().ShootRight(),a==t&&a==n&&this.gameUI.GetFootBallPanel().ShootGoalPost(2),a==t&&this.gameUI.GetFootBallPanel().ShootGoalPost(0),a==n&&this.gameUI.GetFootBallPanel().ShootGoalPost(1)},t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),GameCtrl=function(e){function t(t){var n=e.call(this,GameConfig.GameID)||this;if(n.isAnimateEnd=!1,n.settleData=null,n.cacheData=null,n.roundID=null,n.currentStatus=0,n.onClose=t,n.gameUI=ScenePanel.GameUI.GetInstance(),n.gameUI.ChangeModeHanler(Laya.Handler.create(n,n.ReInit,null,!1)),ScenePanel.GameUI.GetInstance().GetLoadingPanel().ShowConnect(),n.RoundPanelCtrl=new RoundPanelCtrl,n.CardPanelCtrl=new CardPanelCtrl,n.CardPanelCtrl.EndGameHander(Laya.Handler.create(n,n.FlipEnd,null,!1)),n.BetCtrl=new BetPanelCtrl(Laya.Handler.create(n,n.SendHandelr,null,!1),n.authorizationInfo.IsClose,n.memberInfo),n.HistoryPanelCtrl=new HistoryPanelCtrl,n.TimePanelCtrl=new TimePanelCtrl,n.HeadPanelCtrl=new HeadPanelCtrl,n.HeadPanelCtrl.SetInfo(n.memberInfo,n.parentID,n.authorizationInfo.IsTourists),n.authorizationInfo.IsTourists){var a=new TipsPanelCtrl;a.Show()}return n}return __extends(t,e),t.prototype.ReInit=function(){var e,t=(new Date).getTime();this.cacheData&&(e=this.cacheData.BetTime-(t-this.cacheData.BetTimeStamp)/1e3,this.cacheData.BetTimeStamp=t,this.cacheData.BetTime=0>e?0:e,this.OnGameInit(this.cacheData,!0),this.HeadPanelCtrl.SetInfo(this.memberInfo,this.parentID,this.authorizationInfo.IsTourists))},t.prototype.WeChatShareHandler=function(){},t.prototype.OnNoNetwork=function(){},t.prototype.OnConnectHandler=function(){},t.prototype.OnCloseHandler=function(e){ScenePanel.GameUI.GetInstance().GetLoadingPanel().ShowConnect(),console.log(e)},t.prototype.OnErrorHandler=function(e){console.log(e)},t.prototype.OnWillReconnectHandler=function(){console.log("将要重连")},t.prototype.OnLogoutHandler=function(){ScenePanel.GameUI.GetInstance().GetLoadingPanel().HideConnect()},t.prototype.OnAckHandler=function(e){this.BetCtrl.BetAck(e)},t.prototype.OnSystemPushHandler=function(){},t.prototype.SendHandelr=function(e){var t=e.MsgID?e.MsgID:Utils.Guid.Create();this.BetCtrl.SetMsgID(t),this.Send(e.Data,t)},t.prototype.OnGameInit=function(e,t){void 0===t&&(t=!1),console.log("初始化",e),ScenePanel.GameUI.GetInstance().GetLoadingPanel().HideConnect(),this.cacheData=e,(!this.roundID||this.roundID<=e.RoundID)&&(this.roundID=e.RoundID),this.cacheData.BetTimeStamp=(new Date).getTime(),e&&e.RoundID&&this.RoundPanelCtrl.SetGameRound(e.RoundID),0!=e.Status||t?this.RoundPanelCtrl.SetGameState(this.cacheData.Status):this.RoundPanelCtrl.SetGameState(0),1==e.Status&&e.BetTime>0&&(this.TimePanelCtrl.StartGameTime(e.BetTime),this.RoundPanelCtrl.SetGameState(1)),null==e.Cards&&this.TimePanelCtrl.HideGameTime(),e&&(this.BetCtrl.GameInit(e,t),this.cacheData.RoundID=e.RoundID),e&&e.Cards&&this.CardPanelCtrl.InitGame({RoundID:e.RoundID,Cards:e.Cards,BetTime:e.BetTime}),e&&e.History&&this.HistoryPanelCtrl.SetHistoryData(e.History),e&&e.Balance&&this.HeadPanelCtrl.ChangeMoney(e.Balance)},t.prototype.OnGameStart=function(e){if(ScenePanel.GameUI.GetInstance().ClearPokerFly(),this.CardPanelCtrl.ClearPokerFlip(),!this.roundID||this.roundID<e.RoundID)console.log("开始-不同局",e,this.roundID,e.RoundID,(new Date).getTime()),this.roundID=e.RoundID;else{if(this.roundID!=e.RoundID)return console.log("开始 return ",e,this.roundID,e.RoundID,(new Date).getTime()),void 0;console.log("开始-同一局",e,this.roundID,e.RoundID,(new Date).getTime()),this.roundID=e.RoundID}e&&e.RoundID&&(this.cacheData.RoundID=e.RoundID,this.RoundPanelCtrl.SetGameRound(e.RoundID)),this.cacheData.Status=BaseEnum.GameStatus.BET,this.RoundPanelCtrl.SetGameState(1),this.cacheData.TotalBet=null,e&&e.Odds&&(this.cacheData.Odds=e.Odds,this.BetCtrl.GameStart(e.Odds)),e&&e.History&&this.HistoryPanelCtrl.SetHistoryData(e.History),e&&e.BetTime&&(this.cacheData.BetTime=e.BetTime,this.cacheData.BetTimeStamp=(new Date).getTime(),this.TimePanelCtrl.StartGameTime(e.BetTime)),this.cacheData.Cards||(this.cacheData.Cards=new Dto.CardInfoDto),this.cacheData.Cards.FirstCard=e.FirstCard,this.cacheData.Cards.SecondCard=e.SecondCard,this.cacheData.Cards.ThirdCard=0,this.CardPanelCtrl.StartGame(e),this.isAnimateEnd=!1,this.settleData=null},t.prototype.OnBetResult=function(e){if(!this.roundID||this.roundID<e.RoundID)console.log("投注结果",e,this.roundID,e.RoundID),this.roundID=e.RoundID;else{if(this.roundID!=e.RoundID)return console.log("投注结果 return ",e,this.roundID,e.RoundID),void 0;console.log("投注结果-同一局",e,this.roundID,e.RoundID),this.roundID=e.RoundID}this.BetCtrl.BetResult(e),!this.authorizationInfo.IsClose&&e.Success&&(this.HeadPanelCtrl.ChangeMoney(e.Balance),this.cacheData.Balance=e.Balance,this.cacheData.TotalBet=e.TotalBet)},t.prototype.OnStopBet=function(){Utils.BackgroundMusic.PlaySounds("sound/csz1.wav")},t.prototype.OnGameResult=function(e){var t=this;if(!this.roundID||this.roundID<e.RoundID)console.log("结束",e,this.roundID,e.RoundID,(new Date).getTime()),this.roundID=e.RoundID;else{if(this.roundID!=e.RoundID)return console.log("结束 return ",e,this.roundID,e.RoundID,(new Date).getTime()),void 0;console.log("结束-同一局",e,this.roundID,e.RoundID,(new Date).getTime()),this.roundID=e.RoundID}this.cacheData.Status=BaseEnum.GameStatus.END;var n=new Dto.HistoryRoundDto;n.FirstCard=e.FirstCard,n.SecondCard=e.SecondCard,n.ThirdCard=e.ThirdCard,n.RoundID=e.RoundID,this.cacheData.History.push(n),this.cacheData.History.splice(0,1),this.cacheData.Cards.FirstCard=e.FirstCard,this.cacheData.Cards.SecondCard=e.SecondCard,this.cacheData.Cards.ThirdCard=e.ThirdCard,this.RoundPanelCtrl.SetGameState(2),Laya.timer.once(5e3,this,function(){t.cacheData.Status=BaseEnum.GameStatus.SETTLE,t.RoundPanelCtrl.SetGameState(3),t.ChangeMoneyHander&&t.ChangeMoneyHander.run(),t.isAnimateEnd=!0,t.settleData&&t.BetCtrl.SettleResult(t.settleData,e.RoundID)}),this.BetCtrl.GameResult(),this.CardPanelCtrl.EndGame(e),this.TimePanelCtrl.EndGameTime()},t.prototype.FlipEnd=function(e){ScenePanel.GameUI.GetInstance().PokerFly(e.Cards),this.HistoryPanelCtrl.AddHistoryList(e)},t.prototype.OnSettleResult=function(e){var t=this;if(!this.roundID||this.roundID<e.RoundID)console.log("结算",e,this.roundID,e.RoundID),this.roundID=e.RoundID;else{if(this.roundID!=e.RoundID)return console.log("结算 return ",e,this.roundID,e.RoundID),void 0;console.log("结算-同一局",e,this.roundID,e.RoundID),this.roundID=e.RoundID}this.cacheData.Status=BaseEnum.GameStatus.SETTLEED,this.cacheData.TotalBet=e.SettleResult,this.cacheData.Balance=e.Balance,this.cacheData.Cards=JSON.parse(e.GameResult),this.RoundPanelCtrl.SetGameState(4),this.isAnimateEnd?this.BetCtrl.SettleResult(e,e.RoundID):this.settleData=e,this.authorizationInfo.IsClose||(this.ChangeMoneyHander=Laya.Handler.create(this,function(){t.HeadPanelCtrl.ChangeMoney(e.Balance)}))},t.prototype.OnGameOther=function(){},t}(BaseCtrl),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ScenePanel;!function(e){var t=function(t){function n(n){var a=t.call(this)||this;a.isLoginSuccess=!1,a.isLoadSuccess=!1,a.eventDispatcher=new laya.events.EventDispatcher,a.onGameLoadSuccess=n,document.addEventListener("screenMode",function(){a.gameLoadScenes=GameConfig.ScreenMode?new e.GameLoadScenes:new e.GameLoadScenes_Ver,Laya.stage.addChild(a.gameLoadScenes.GetUI())}),a.memberServer=new ServiceManager.MemberManager(GameConfig.GameID);var o=a.memberServer.GetSocketInfo();if(o.Token)a.LoginSuccess(o.Token);else{var r=(Utils.Url.GetQuery("parentid"),new BaseDto.LoginDto);r.DeviceType=GameConfig.DeviceType,r.DeviceId=GameConfig.DeviceId;var s=Laya.Handler.create(a,a.LoginSuccess,null,!1),i=Laya.Handler.create(a,a.LoginError,null,!1);a.memberServer.LoginByTourists(r,o.Token,s,i)}var c=Laya.Browser.window.location.href;return a.memberServer.GetJsSignature(c,Laya.Handler.create(a,a.GetWeChatSuccess,null,!1)),a.onLoaded(),a}return __extends(n,t),n.prototype.GetWeChatSuccess=function(e){var t=new Utils.WeChat;t.Init(e)},n.prototype.LoginSuccess=function(e){var t=this,n=Laya.Handler.create(this,function(){t.isLoginSuccess=!0,t.isLoadSuccess&&(document.removeEventListener("screenMode",function(){console.log("screenMode")}),t.onGameLoadSuccess.run())},null,!1),a=Laya.Handler.create(this,this.LoginError,null,!1);this.memberServer.GetSocketToken(e,n,a)},n.prototype.LoginError=function(e){this.gameLoadScenes.LoadError(e),this.isLoginSuccess=!1,console.log(e)},n.prototype.onLoaded=function(){this.gameLoadScenes=GameConfig.ScreenMode?new e.GameLoadScenes:new e.GameLoadScenes_Ver,Laya.stage.addChild(this.gameLoadScenes.GetUI());var t=e.LoadResourcesConfig;Laya.loader.load(t,Laya.Handler.create(this,this.onLoadResource),Laya.Handler.create(this,this.onProgress,null,!1))},n.prototype.onProgress=function(e){this.gameLoadScenes.LoadProgress(e)},n.prototype.onLoadResource=function(){this.isLoadSuccess=!0,this.isLoginSuccess&&this.onGameLoadSuccess.run()},n}(Laya.Sprite);e.GameLoadCtrl=t}(ScenePanel||(ScenePanel={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),HeadPanelCtrl=function(e){function t(){var t=e.call(this)||this;return t.gameUI=ScenePanel.GameUI.GetInstance(),t.noteRecordPanelCtrl=new NoteRecordPanelCtrl,t}return __extends(t,e),t.prototype.SetInfo=function(e,t,n){var a=Laya.Handler.create(this,this.OnClickGR,null,!1),o=Laya.Handler.create(this,this.OnClickRule,null,!1);this.gameUI.GetHeadPanel().SetInfo(e,t,a,o,n)},t.prototype.OnClickGR=function(){this.noteRecordPanelCtrl.ShowNoteRecord()},t.prototype.OnClickRule=function(){this.gameUI.GetRulePanel().ShowRule()},t.prototype.ChangeMoney=function(e){this.gameUI.GetHeadPanel().ChangeMoney(e)},t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),HistoryPanelCtrl=function(e){function t(){var t=e.call(this)||this;return t.index=0,t}return __extends(t,e),t.prototype.GetPokerUrl=function(e){return"ui/poker/"+e+".png"},t.prototype.SetHistoryData=function(e){if(this.listArr=[],this.roundIDArr=[],!e)return ScenePanel.GameUI.GetInstance().GetHistoryPanel().ShowList(!1),void 0;ScenePanel.GameUI.GetInstance().GetHistoryPanel().ShowList(!0),this.index=e.length;for(var t=0;t<this.index;t++){var n={poker0:{skin:this.GetPokerUrl(e[t].FirstCard)},poker1:{skin:this.GetPokerUrl(e[t].SecondCard)},poker2:{skin:this.GetPokerUrl(e[t].ThirdCard)}};this.listArr.unshift(n),this.roundIDArr.push({RoundID:e[t].RoundID})}ScenePanel.GameUI.GetInstance().GetHistoryPanel().SetListArray(this.listArr),ScenePanel.GameUI.GetInstance().GetHistoryPanel().SetRenderHandler(new Laya.Handler(this,this.onRender))},t.prototype.onRender=function(e,t){if(!(t>this.listArr.length)){var n=this.listArr[t],a=e.getChildByName("poker0"),o=e.getChildByName("poker1"),r=e.getChildByName("poker2");a.skin=n.poker0.skin,o.skin=n.poker1.skin,r.skin=n.poker2.skin}},t.prototype.AddHistoryList=function(e){var t=this;ScenePanel.GameUI.GetInstance().GetHistoryPanel().ScrollHistoryList(Laya.Handler.create(this,function(){for(var n=!1,a=0;a<t.index;a++)t.roundIDArr[a].RoundID==e.RoundID&&(n=!0);if(!n){var o={poker0:{skin:t.GetPokerUrl(e.Cards.FirstCard)},poker1:{skin:t.GetPokerUrl(e.Cards.SecondCard)},poker2:{skin:t.GetPokerUrl(e.Cards.ThirdCard)}};t.listArr.unshift(o),ScenePanel.GameUI.GetInstance().GetHistoryPanel().SetListArray(t.listArr)}}))},t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),NoteRecordPanelCtrl=function(e){function t(){var t=e.call(this)||this;return t.dataArr=[],t.listArr=[],t.noMoreData=!1,t.isActiveData=!1,t.scrollValue=0,t.gameUI=ScenePanel.GameUI.GetInstance(),t.betRecordPageDto=new Dto.BetRecordPageDto,t.betRecordPageDto.GameId=GameConfig.GameID,t.betRecordPageDto.PageSize=10,t.gameUI.GetNoteRecordPanel().OnMouseDownHander(new Laya.Handler(t,t.OnMouseDown)),t.gameUI.GetNoteRecordPanel().OnMouseUpHander(new Laya.Handler(t,t.OnMouseUp)),t.gameUI.GetNoteRecordPanel().CloseRecordHander(new Laya.Handler(t,t.CloseNoteRecord)),t}return __extends(t,e),t.prototype.OnMouseDown=function(e){this.mouseDownY=e},t.prototype.OnMouseUp=function(e){0==this.scrollValue&&e-this.mouseDownY>100&&this.DownRefresh(!0),this.noMoreData||this.scrollValue>=this.dataArr.length*this.listBoxH-this.recordListH&&this.mouseDownY-e>100&&this.UpLoading()},t.prototype.ShowNoteRecord=function(){this.DownRefresh(!0),this.gameUI.GetNoteRecordPanel().SetScrollBarSkin()},t.prototype.CloseNoteRecord=function(){this.dataArr=[],this.gameUI.GetNoteRecordPanel().SetListArray(this.dataArr),this.ClearTextureRes()},t.prototype.ClearTextureRes=function(){Laya.loader.clearTextureRes("ui/mask.png"),Laya.loader.clearTextureRes("ui/bg_record.png"),Laya.loader.clearTextureRes("ui/recordLine.png")},t.prototype.GetNoteRecordData=function(e){this.listArr=[],this.index=e.length;for(var t=0;t<this.index;t++){var n={betTime:{text:Utils.Time.transform(e[t].BetTime,1)},betDate:{text:Utils.Time.transform(e[t].BetTime,0)},roundId:{text:e[t].RoundId},gameData:e[t].GameData,total:{text:Utils.Float.Sub(e[t].PayAmount,e[t].BetAmount)}};this.listArr.push(n)}this.dataArr=this.dataArr.concat(this.listArr),this.gameUI.GetNoteRecordPanel().SetListArray(this.dataArr),this.gameUI.GetNoteRecordPanel().SetRenderHander(new Laya.Handler(this,this.onRender)),this.gameUI.GetNoteRecordPanel().SetMouseHander(new Laya.Handler(this,this.onMouse))},t.prototype.Success=function(e){for(var t=e.Data,n=0;n<t.length;n++)t[n].GameData=JSON.parse(t[n].GameData);this.GetNoteRecordData(t),!t||t.length<10?this.noMoreData=!0:this.betRecordPageDto.LastId=t[t.length-1].Id,this.gameUI.GetNoteRecordPanel().ShowLoading(!1)},t.prototype.Error=function(){},t.prototype.UpLoading=function(){this.isActiveData=!1,Net.WebApi.GetInstance().GetBetRecord(this.betRecordPageDto,Laya.Handler.create(this,this.Success,null,!1),Laya.Handler.create(this,this.Error,null,!1))},t.prototype.DownRefresh=function(e){void 0===e&&(e=!1),this.betRecordPageDto.LastId=null,this.noMoreData=!1,this.isActiveData=!0,this.dataArr=[],e&&this.gameUI.GetNoteRecordPanel().ShowInit(),this.gameUI.GetNoteRecordPanel().ShowLoading(!0),Net.WebApi.GetInstance().GetBetRecord(this.betRecordPageDto,Laya.Handler.create(this,this.Success,null,!1),Laya.Handler.create(this,this.Error,null,!1))},t.prototype.onRender=function(e,t){if(!(t>this.dataArr.length)){var n=this.dataArr[t];this.listBoxH=e.height,this.recordListH=this.gameUI.GetNoteRecordPanel().GetListHeight();var a=e.getChildByName("betTime"),o=e.getChildByName("betDate"),r=e.getChildByName("roundId"),s=e.getChildByName("total");a.text=n.betTime.text,o.text=n.betDate.text,r.text=n.roundId.text,s.text=n.total.text}},t.prototype.onMouse=function(e,t){if(this.scrollValue=this.gameUI.GetNoteRecordPanel().GetListScrollValue(),e.type==Laya.Event.CLICK){var n=this.dataArr[t];this.gameUI.GetNoteRecordPanel().GoNoteRecordDetail(n)}},t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),PromptPanelCtrl=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),TimePanelCtrl=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.StartGameTime=function(e){ScenePanel.GameUI.GetInstance().GetTimePanel().StartGameTime(e)},t.prototype.EndGameTime=function(){ScenePanel.GameUI.GetInstance().GetTimePanel().EndGameTime()},t.prototype.HideGameTime=function(){ScenePanel.GameUI.GetInstance().GetTimePanel().HideGameTime()},t}(Laya.Sprite),GameMain=function(){function e(){new InitState,new ScenePanel.GameLoadCtrl(Laya.Handler.create(this,this.onGameLoadSuccess))}return e.prototype.onGameLoadSuccess=function(){this.GameCtrl=new GameCtrl(Laya.Handler.create(this,this.onGameLoadSuccess))},e}();new GameMain;